{% extends "vs_base.html" %}

{% load match_center_tags %}

{% block head-addition %}
    <script src="{{ STATIC_URL }}js/radar.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}/js/timeline.js" type="text/javascript"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.10/socket.io.min.js"></script>
    <script type="text/javascript"> window.matchId = {{selectedMatch}}; </script>
    <script src="{{ STATIC_URL }}js/radar_ui.js" type="text/javascript"></script>

    <link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/radar.css" />
    <link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/teambar-style.css" />
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="{{ STATIC_URL }}js/simpled3.js"></script>

    <script type="text/javascript">

        var valueMap = {1: "events",
            2: "narrations",
            3: "teamstats",
            4: "playerstats"};

        function handleSelect(elm)
        {
            $(".inside-menu button.active").removeClass("active");
            $(elm).addClass("active");
            if (elm.value == 3) {
                loadTeamStats();
            }
            else {
                var url = '/new/partial/' + valueMap[elm.value] + "/{{ selectedMatch }}/";
                $("#data-area").load(url);
            }
        }

        function loadTeamStats(){
            $.ajax({
                dataType: "json",
                url: "/new/partial/teamdump/{{ selectedMatch }}",
                success: function(d){

                    console.log(d);
                    var pref = {
                        "width": $("#data-area").width()
                    };
                    $("#data-area").empty();
                    simpleBar("#data-area", d.teamStats, pref);
                }
            });
        }

        function refreshScreens()
        {
            var activeTab = $(".inside-menu button.active").attr("value");
            console.log(activeTab);
            if (activeTab==3){
                loadTeamStats();
            }
            else {
                var url = '/new/partial/' + valueMap[activeTab] + "/{{ selectedMatch }}/";
                console.log(activeTab);
                $("#data-area").load(url);
            }
        }

        function bindTimer(){
            setInterval(refreshScreens, 30000);
        }
        bindTimer();
    </script>

    <script type="text/javascript">
        $(function(){
                    $.event.trigger({
                        type: "radarPlayerClick",
                        "team_id": {{ gks.0.team_id }},
                        "jersey_no": {{ gks.0.jersey_no }},
                        "player_id": {{ gks.0.player_id }},
                        "homeOrAway": 0,
                        "week": {{ currentWeek }}
                    });

                    $.event.trigger({
                        type: "radarPlayerClick",
                        "team_id": {{ gks.1.team_id }},
                        "jersey_no": {{ gks.1.jersey_no }},
                        "player_id": {{ gks.1.player_id }},
                        "homeOrAway": 1,
                        "week": {{ currentWeek }}
                    });
                }
        );

    </script>

{% endblock %}


{% block menu %}
    <div id="navbar">
        <div id="nav">
            <a href="../before">MAÇ ÖNCESİ</a>
            <div id="active">
                <a href="../center">STADYUM</a>
            </div>
            <a href="../table">MAÇ TAHTASI</a>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="row">
        <canvas id="slider"></canvas>
    </div>
    <div class="row">
        <div id="radarContainer">
            <button class="btn" id="pauseMatch"><i class="icon-play"></i></button>
            <!--<button class="btn" id="showFormation">Formasyon</button>
            <button class="btn" id="showRadar">Radar</button>-->
            <button class="btn" id="popMessage"></button>
            <span id="timeDisplay" class="pull-right"></span></p>
            <div id="canvasContainer" style="position: relative;">
                <div id="canvasOverlay">
                    <!--<p class="canvas-message"></p>-->
                    <p id="canvas-play-button"><i class="icon-white icon-play"></i></p>
                </div>
            </div>
            <!--<div id="likeCanvas" >
                <table class ="formationTable" border="1" >
                    <tr>
                        <td id="home_LB" ></td>
                        <td id="home_WBL" ></td>
                        <td id="home_ML" ></td>
                        <td id="home_AML" ></td>
                        <td id="home_WL" ></td>

                    </tr>
                    <tr>
                        <td id="home_CBL" ></td>
                        <td id="home_DML" ></td>
                        <td id="home_MCL" ></td>
                        <td id="home_AMCL" ></td>
                        <td id="home_FL" ></td>

                    </tr>
                    <tr>
                        <td id="home_DC" ></td>
                        <td id="home_DMC" ></td>
                        <td id="home_MC" ></td>
                        <td id="home_AMC" ></td>
                        <td id="home_FC" ></td>

                    </tr>
                    <tr>
                        <td id="home_CBR" ></td>
                        <td id="home_DMR" ></td>
                        <td id="home_MCR" ></td>
                        <td id="home_AMCR" ></td>
                        <td id="home_FR" ></td>

                    </tr>
                    <tr>
                        <td id="home_RB" ></td>
                        <td id="home_WBR" ></td>
                        <td id="home_MR" ></td>
                        <td id="home_AMR" ></td>
                        <td id="home_WR" ></td>

                    </tr>
                </table>

                <table  class ="formationTable secondTable" border="1" >
                    <tr>

                        <td id="away_WR"></td>
                        <td id="away_AMR"></td>
                        <td id="away_MR"></td>
                        <td id="away_WBR"></td>
                        <td id="away_RB"></td>
                    </tr>
                    <tr>

                        <td id="away_FR" ></td>
                        <td id="away_AMCR" ></td>
                        <td id="away_MCR"  ></td>
                        <td id="away_DMR"  ></td>
                        <td id="away_CBR"  ></td>
                    </tr>
                    <tr>

                        <td id="away_FC" ></td>
                        <td id="away_AMC" ></td>
                        <td id="away_MC" ></td>
                        <td id="away_DMC" ></td>
                        <td id="away_DC" ></td>
                    </tr>
                    <tr>

                        <td id="away_FL" ></td>
                        <td id="away_AMCL" ></td>
                        <td id="away_MCL" ></td>
                        <td id="away_DML" ></td>
                        <td id="away_CBL" ></td>
                    </tr>
                    <tr>

                        <td id="away_WL" ></td>
                        <td id="away_AML" ></td>
                        <td id="away_ML" ></td>
                        <td id="away_WBL" ></td>
                        <td id="away_LB" ></td>
                    </tr>
                </table>
            </div>-->
        </div>
    </div>

    <div class="row" id="playerCardsContainer">
        <div class="span4 card-container" id="leftPlayerCard">
            <div class="card-header row-fluid">
                <img class="playerImage" src="{{STATIC_URL}}images/players/default.png">
                <div class="playerInfo">
                    <p class="playerName">Oyuncu Karti</p>
                </div>
            </div>
            <div class="card-data row-fluid">
                <table class="card-table">
                    <tr>
                        <th>İstatistik</th>
                        <th>Bu Sezon</th>
                        <th>Bu Hafta</th>
                    </tr>
                </table>
            </div>
        </div>

        <div class="span4 card-container" id="rightPlayerCard">
            <div class="card-header row-fluid">
                <img class="playerImage" src="{{STATIC_URL}}images/players/default.png">
                <div class="playerInfo">
                    <p class="playerName">Oyuncu Karti</p>
                </div>
            </div>
            <div class="card-data row-fluid">
                <table class="card-table">
                    <tr>
                        <th>İstatistik</th>
                        <th>Bu Sezon</th>
                        <th>Bu Hafta</th>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="inside-menu">
        <button value="1" class="active" onclick="handleSelect(this)">OLAYLAR</button>
        <button value="2" onclick="handleSelect(this)">ANLATIM</button>
        <button value="3" onclick="handleSelect(this)">TAKIM İSTATİSTİKLERİ</button>
        <button value="4" onclick="handleSelect(this)">OYUNCU İSTATİSTİKLERİ</button>
    </div>

    <div class="data-area" id="data-area">

    </div>
    <script>
        var url = '/new/partial/' + valueMap[1] + "/{{ selectedMatch }}/";
        $("#data-area").load(url);
    </script>


{% endblock %}

<!--<script type="text/javascript" src="{{ STATIC_URL }}js/mustache.js"></script>

<script type="text/javascript">
$("#likeCanvas").hide();
$("#showFormation").onclick(function(){
    $("#canvasContainer").hide();
    $("#likeCanvas").show();
});
$("#showRadar").onclick(function(){
    $("#likeCanvas").hide();
    $("#canvasContainer").show();
});


$( document ).ready(function() {
    //console.log( "ready!" );


    function serviceRequest(method, data, callback){
        $.post("/api/" + method, JSON.stringify(data)).done(function(data){
            callback(JSON.parse(data).data);
        });
    }


    function getRandomizer(bottom, top) {
        return Math.floor( Math.random() * ( 1 + top - bottom ) ) + bottom;
    }



    var matchInfo = null;
    var matchId = 11868966;
    var homeTeamID = 0;
    var awayTeamID = 0;
    var imageServiceLink = "http://sentiong.cloudapp.net/static/images/players/";
    var defaultPlayerImage = "http://sentiong.cloudapp.net/static/images/players/default.png";
    var homeTeamSubs = [[188,430],[130,430],[72,430]]
    var awayTeamSubs = [[552,430],[493,430],[434,430]];

    //Gets Match Info
    serviceRequest("GetMatchInfo",{"matchId": matchId},function(result){
        matchInfo = result;
        homeTeamID = matchInfo[0][5];
        awayTeamID = matchInfo[0][6];
        //console.log("home Team ID : " + homeTeamID + "Away team ID : " + awayTeamID);
    });





    //Gets match details
    serviceRequest("GetMatchSquad", {"matchId": matchId }, function(teamData){

        var teamCountFormation = 0;
        var teamCountFormation2 = 0;

        console.log(teamData);

        _.each(teamData, function(value, i){



            var playerName = value.data[0].split(" ");

            var goalKeeperHome = [190,23];
            var goalKeeperAway = [190,593];

            var playerID = value.data[5];
            var imgVal = null;
            var jerseyNumber = value.data[1];
            var playerTeamID = value.data[3];
            var playerPosition = value.data[17];
            var playerIsPlayed = value.data[16];

            var imageLink = imageServiceLink + playerID + ".jpg";

            if(getRandomizer(0,1))
            {
                imgVal = "img/playerChange.png";
            }

            if( playerName[1] == null)
                playerName[1] = playerName[0];

            if(playerName[1].length > 7)
            {
                playerName[1] = playerName[1].slice(0,7);
                playerName[1] += '.';
                //console.log("9 - > " + playerName[1]);
            }


            var leftM = 0;
            var topM = 0;
            if(playerPosition == "GK")
            {
                if(playerTeamID == homeTeamID)
                {
                    leftM = goalKeeperHome[1];
                    topM = goalKeeperHome[0];
                }

                if(playerTeamID == awayTeamID)
                {
                    leftM = goalKeeperAway[1];
                    topM = goalKeeperAway[0];
                }
            }


            if(playerTeamID == homeTeamID && playerPosition == "" && playerIsPlayed)
            {
                var x = homeTeamSubs.pop();
                leftM = x[0];
                topM = x[1];
            }


            if(playerTeamID == awayTeamID && playerPosition == "" && playerIsPlayed)
            {
                var x = awayTeamSubs.pop();
                leftM = x[0];
                topM = x[1];
            }

            var template = $('#exampleTemplate').html();
            var data = {

                //playerName : jerseyNumber + "-" + playerName[0],
                playerName : jerseyNumber,

                playerLastName: playerName[1],




                ID : i,
                left: leftM, //getRandomizer(0,550),
                top: topM,//getRandomizer(0,350),
                teamID : playerTeamID,

                imageUrl0 : imageLink,
                errorLink: defaultPlayerImage

            };



            //adding new notes to data:

            var eventImageCount = 1;

            _.each(value.events, function(eventValue, j){
                var eventType = eventValue[0];
                var subData = eventValue[4];

                var imageUrl = "imageUrl" + eventImageCount;
                var imageData = "imageData" + eventImageCount;



                if(eventType == 0)
                {
                    //console.log("Event  : Goal");
                    data[imageUrl] = "img/goal.png";
                    data[imageData] = eventValue;
                    eventImageCount++;
                }
                else if(eventType == 1)
                {
                    //console.log("Event : Own Goal");
                    data[imageUrl] = "img/own-goal.png";
                    data[imageData] = eventValue;
                    eventImageCount++;
                }
                else if(eventType == 2)
                {
                    //console.log("Event : Penalty");
                    data[imageUrl] = "img/penalty.png";
                    data[imageData] = eventValue;
                    eventImageCount++;
                }
                else if(eventType == 3)
                {
                    //console.log("Event : Missed Penalty");
                    data[imageUrl] = "img/missed-pen.png";
                    data[imageData] = eventValue;
                    eventImageCount++;
                }
                else if(eventType == 4)
                {
                    //console.log("Event : Yellow Cart");
                    data[imageUrl] = "img/yellow.png";
                    data[imageData] = eventValue;
                    eventImageCount++;
                }
                else if(eventType == 5)
                {
                    //console.log("Event : Second Yellow");
                    data[imageUrl] = "img/second-yellow.png";
                    data[imageData] = eventValue;
                    eventImageCount++;
                }
                else if(eventType == 6)
                {

                    data[imageUrl] = "img/red.png";
                    data[imageData] = eventValue;
                    eventImageCount++;
                }
                else if(eventType == 7)
                {

                    data[imageData] = eventValue;


                    var subPlayerID = eventValue[3];

                    if(playerID == subPlayerID )
                        data[imageUrl] = "img/sub-out.png";
                    else
                        data[imageUrl] = "img/sub-in.png";

                    eventImageCount++;
                }
            });




            var htmlData = Mustache.to_html(template, data);

            var playerDisplayPosition = "#";
            //placeArray.splice(arrayIndex,1);



            //$(playerDisplayPosition).append(htmlData);

            if(playerPosition != "")
            {

                if(playerPosition == "GK")
                {
                    $("#likeCanvas").append(htmlData);
                }

                if((playerTeamID == homeTeamID) )
                {
                    playerDisplayPosition = playerDisplayPosition + "home_" + playerPosition.replace(/\s/g, "");


                    if(playerName[1] == "Aissati")
                        console.log("->>>>>>" + playerPosition);

                } else

                if((playerTeamID == awayTeamID) )
                {
                    playerDisplayPosition = playerDisplayPosition + "away_" + playerPosition.replace(/\s/g, "");

                }

                if($(playerDisplayPosition).size != 0)
                    $(playerDisplayPosition).append( htmlData );

            }

            else if(playerIsPlayed)
            {
                $("#likeCanvas").append( htmlData );
            }


        });


        var sth = 0;
        $('#formationTable td').each(function(index, value){
            //console.log(index + " - " + value );

            if(($( value ).has( ".playerDisplay" ).length ? "Yes" : "No" ) == "No" && ((sth % 5) != 0)  )
            {
                $(value).remove();
            }

            sth += 1;
        });

        $('.eventImages').each(function(){ $(this).mouseenter(function(){
            $(this).css({"border-style":"solid",'border-width' : "1px"});
            //$(this).imageInfo = "xxx";
            console.log($(this).attr("imageInfo"));
            //console.log(imageDataValue);
        }); });

        $('.eventImages').each(function(){ $(this).mouseleave(function(){
            $(this).css({"border-style":"none"});

        }); });

        $('.texts').each(function(){ $(this).mouseenter(function(){
        }); });


        $.each($(".playerDisplay"),function( index, pd ) {
            //console.log($(pd).attr("teamID"));


            $(this).data("MyDataAttribute",index);

            //console.log($(this).find(".jerseyNumber").val());
            if($(this).attr("teamID") == homeTeamID){
                //$(this).css({"background-color" : "#FF8909"});
                $(this).find("#divJS").css({"background-image" : "url('img/blueBackground.png')"});
            }
            else{
                //$(this).css({"background-color" : "#7078E8"});
                $(this).find("#divJS").css({"background-image" : "url('img/redBackground.png')"});
            }



        });


        $(".playerDisplay").draggable();
    });



    jQuery('#likeCanvas').click(function(e){
        var x = e.pageX - e.target.offsetLeft ;
        var y = e.pageY - e.target.offsetTop ;

        console.log(x + "--" + y );



    });

    var i = 1;


});





</script>


<style type="text/css">

    .playerDisplay
    {
        width: 45;
        height: 75;
        background-color: transparent;
        position: inherit;
        min-width: 45;

    }
    .firstPart
    {
        width: auto;
        height: 35;
        background-color: transparent;
    }
    .secondPart
    {
        width: auto;
        height: auto;
        background-color: transparent;

    }
    .thirdPart
    {
        width: auto;
        height: auto;
        background-color: transparent;
    }

    #likeCanvas
    {
        background-image: url('{{ STATIC_URL }}images/radar.png');
        width: 662;
        height:545;
        position: absolute;
    }

    .eventImages
    {
        max-height: 15;
        max-width: 15;
        min-width: 0;
        min-height: 0;
    }

    .playerImage
    {
        height: 35;
        width: auto;
    }

    .texts
    {

    }

    .homeTeamDiv{


        background-image:url('{{ STATIC_URL }}images/redBackground.png');
        background-repeat:repeat;


    }

    .awayTeamDiv{


        background-image:url('{{ STATIC_URL }}images/blueBackground.png');
        background-repeat:repeat;
    }

    .jerseyNumber
    {
        text-align: center;
        min-width: 30;
        font-weight: normal;

    }


    #formationTable, td
    {
        max-width: 45;
        max-height: 60;
        border:1px none red;
        vertical-align: middle;
        text-align: center;
        margin: auto;
        min-width: 15;
        min-height: 15;
    }

    #formationTable, table
    {
        border:1px none red;
        margin-top: 20;
        margin-left: 72;
        padding-left: 0;
        float: left;

    }





</style>-->


