{% extends "vs_base.html" %}

{% load match_center_tags %}

{% block head-addition %}
    <script src="{{ STATIC_URL }}js/radar.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}/js/timeline.js" type="text/javascript"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.10/socket.io.min.js"></script>
    <script type="text/javascript"> window.matchId = {{selectedMatch}}; </script>
    <script src="{{ STATIC_URL }}js/radar_ui.js" type="text/javascript"></script>

    <link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/radar.css" />
    <link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/teambar-style.css" />
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="{{ STATIC_URL }}js/simpled3.js"></script>

    <script type="text/javascript">

        var valueMap = {1: "events",
            2: "narrations",
            3: "teamstats",
            4: "playerstats"};

        function handleSelect(elm)
        {
            $(".inside-menu button.active").removeClass("active");
            $(elm).addClass("active");
            if (elm.value == 3) {
                loadTeamStats();
            }
            else {
                var url = '/new/partial/' + valueMap[elm.value] + "/{{ selectedMatch }}/";
                $("#data-area").load(url);
            }
        }

        function loadTeamStats(){
            $.ajax({
                dataType: "json",
                url: "/new/partial/teamdump/{{ selectedMatch }}",
                success: function(d){

                    console.log(d);
                    var pref = {
                        "width": $("#data-area").width()
                    };
                    $("#data-area").empty();
                    simpleBar("#data-area", d.teamStats, pref);
                }
            });
        }

        function refreshScreens()
        {
            var activeTab = $(".inside-menu button.active").attr("value");
            console.log(activeTab);
            if (activeTab==3){
                loadTeamStats();
            }
            else {
                var url = '/new/partial/' + valueMap[activeTab] + "/{{ selectedMatch }}/";
                console.log(activeTab);
                $("#data-area").load(url);
            }
            $("#sidestats-container").load("/new/partial/sidestats/{{ selectedMatch }}/")
        }

        function bindTimer(){
            setInterval(refreshScreens, 30000);
        }
        bindTimer();
    </script>

    <script type="text/javascript">
        $(function(){
                    $.event.trigger({
                        type: "radarPlayerClick",
                        "team_id": {{ gks.0.team_id }},
                        "jersey_no": {{ gks.0.jersey_no }},
                        "player_id": {{ gks.0.player_id }},
                        "homeOrAway": 0,
                        "week": {{ currentWeek }}
                    });

                    $.event.trigger({
                        type: "radarPlayerClick",
                        "team_id": {{ gks.1.team_id }},
                        "jersey_no": {{ gks.1.jersey_no }},
                        "player_id": {{ gks.1.player_id }},
                        "homeOrAway": 1,
                        "week": {{ currentWeek }}
                    });
                }
        );

    </script>

{% endblock %}


{% block menu %}
    <div id="navbar">
        <div id="nav">
            <a href="../before">MAÇ ÖNCESİ</a>
            <div id="active">
                <a href="../center">STADYUM</a>
            </div>
            <a href="../table">MAÇ TAHTASI</a>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="row">
        <canvas id="slider"></canvas>
    </div>
    <div class="row">
        <div id="radarContainer">
            <button class="btn" id="pauseMatch"><i class="icon-play"></i></button>
            <button class="btn" id="popMessage"></button>
            <span id="timeDisplay" class="pull-right"></span></p>
            <div id="canvasContainer" style="position: relative;">
                <div id="canvasOverlay">
                    <p class="canvas-message"></p>
                </div>
            </div>
        </div>
    </div>

    <div class="row" id="playerCardsContainer">
        <div class="span4 card-container" id="leftPlayerCard">
            <div class="card-header row-fluid">
                <img class="playerImage" src="{{STATIC_URL}}images/players/default.png">
                <div class="playerInfo">
                    <p class="playerName">Oyuncu Karti</p>
                </div>
            </div>
            <div class="card-data row-fluid">
                <table class="card-table">
                    <tr>
                        <th>İstatistik</th>
                        <th>Bu Sezon</th>
                        <th>Bu Hafta</th>
                    </tr>
                </table>
            </div>
        </div>

        <div class="span4 card-container" id="rightPlayerCard">
            <div class="card-header row-fluid">
                <img class="playerImage" src="{{STATIC_URL}}images/players/default.png">
                <div class="playerInfo">
                    <p class="playerName">Oyuncu Karti</p>
                </div>
            </div>
            <div class="card-data row-fluid">
                <table class="card-table">
                    <tr>
                        <th>İstatistik</th>
                        <th>Bu Sezon</th>
                        <th>Bu Hafta</th>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="inside-menu">
        <button value="1" class="active" onclick="handleSelect(this)">OLAYLAR</button>
        <button value="2" onclick="handleSelect(this)">ANLATIM</button>
        <button value="3" onclick="handleSelect(this)">TAKIM İSTATİSTİKLERİ</button>
        <button value="4" onclick="handleSelect(this)">OYUNCU İSTATİSTİKLERİ</button>
    </div>

    <div class="data-area" id="data-area">

    </div>
    <script>
        var url = '/new/partial/' + valueMap[1] + "/{{ selectedMatch }}/";
        $("#data-area").load(url);
    </script>


{% endblock %}


